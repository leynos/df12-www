<!doctype html>
<html lang="en" data-theme="df12">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link href="assets/site.css" rel="stylesheet" />
  <title>df12 Productions — Illustrative Usecase: Real-time Chat Application | Falcon Pachinko</title>
  <style>
    pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #49483e }
.codehilite { background: #272822; color: #F8F8F2 }
.codehilite .c { color: #959077 } /* Comment */
.codehilite .err { color: #ED007E; background-color: #1E0010 } /* Error */
.codehilite .esc { color: #F8F8F2 } /* Escape */
.codehilite .g { color: #F8F8F2 } /* Generic */
.codehilite .k { color: #66D9EF } /* Keyword */
.codehilite .l { color: #AE81FF } /* Literal */
.codehilite .n { color: #F8F8F2 } /* Name */
.codehilite .o { color: #FF4689 } /* Operator */
.codehilite .x { color: #F8F8F2 } /* Other */
.codehilite .p { color: #F8F8F2 } /* Punctuation */
.codehilite .ch { color: #959077 } /* Comment.Hashbang */
.codehilite .cm { color: #959077 } /* Comment.Multiline */
.codehilite .cp { color: #959077 } /* Comment.Preproc */
.codehilite .cpf { color: #959077 } /* Comment.PreprocFile */
.codehilite .c1 { color: #959077 } /* Comment.Single */
.codehilite .cs { color: #959077 } /* Comment.Special */
.codehilite .gd { color: #FF4689 } /* Generic.Deleted */
.codehilite .ge { color: #F8F8F2; font-style: italic } /* Generic.Emph */
.codehilite .ges { color: #F8F8F2; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.codehilite .gr { color: #F8F8F2 } /* Generic.Error */
.codehilite .gh { color: #F8F8F2 } /* Generic.Heading */
.codehilite .gi { color: #A6E22E } /* Generic.Inserted */
.codehilite .go { color: #66D9EF } /* Generic.Output */
.codehilite .gp { color: #FF4689; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { color: #F8F8F2; font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #959077 } /* Generic.Subheading */
.codehilite .gt { color: #F8F8F2 } /* Generic.Traceback */
.codehilite .kc { color: #66D9EF } /* Keyword.Constant */
.codehilite .kd { color: #66D9EF } /* Keyword.Declaration */
.codehilite .kn { color: #FF4689 } /* Keyword.Namespace */
.codehilite .kp { color: #66D9EF } /* Keyword.Pseudo */
.codehilite .kr { color: #66D9EF } /* Keyword.Reserved */
.codehilite .kt { color: #66D9EF } /* Keyword.Type */
.codehilite .ld { color: #E6DB74 } /* Literal.Date */
.codehilite .m { color: #AE81FF } /* Literal.Number */
.codehilite .s { color: #E6DB74 } /* Literal.String */
.codehilite .na { color: #A6E22E } /* Name.Attribute */
.codehilite .nb { color: #F8F8F2 } /* Name.Builtin */
.codehilite .nc { color: #A6E22E } /* Name.Class */
.codehilite .no { color: #66D9EF } /* Name.Constant */
.codehilite .nd { color: #A6E22E } /* Name.Decorator */
.codehilite .ni { color: #F8F8F2 } /* Name.Entity */
.codehilite .ne { color: #A6E22E } /* Name.Exception */
.codehilite .nf { color: #A6E22E } /* Name.Function */
.codehilite .nl { color: #F8F8F2 } /* Name.Label */
.codehilite .nn { color: #F8F8F2 } /* Name.Namespace */
.codehilite .nx { color: #A6E22E } /* Name.Other */
.codehilite .py { color: #F8F8F2 } /* Name.Property */
.codehilite .nt { color: #FF4689 } /* Name.Tag */
.codehilite .nv { color: #F8F8F2 } /* Name.Variable */
.codehilite .ow { color: #FF4689 } /* Operator.Word */
.codehilite .pm { color: #F8F8F2 } /* Punctuation.Marker */
.codehilite .w { color: #F8F8F2 } /* Text.Whitespace */
.codehilite .mb { color: #AE81FF } /* Literal.Number.Bin */
.codehilite .mf { color: #AE81FF } /* Literal.Number.Float */
.codehilite .mh { color: #AE81FF } /* Literal.Number.Hex */
.codehilite .mi { color: #AE81FF } /* Literal.Number.Integer */
.codehilite .mo { color: #AE81FF } /* Literal.Number.Oct */
.codehilite .sa { color: #E6DB74 } /* Literal.String.Affix */
.codehilite .sb { color: #E6DB74 } /* Literal.String.Backtick */
.codehilite .sc { color: #E6DB74 } /* Literal.String.Char */
.codehilite .dl { color: #E6DB74 } /* Literal.String.Delimiter */
.codehilite .sd { color: #E6DB74 } /* Literal.String.Doc */
.codehilite .s2 { color: #E6DB74 } /* Literal.String.Double */
.codehilite .se { color: #AE81FF } /* Literal.String.Escape */
.codehilite .sh { color: #E6DB74 } /* Literal.String.Heredoc */
.codehilite .si { color: #E6DB74 } /* Literal.String.Interpol */
.codehilite .sx { color: #E6DB74 } /* Literal.String.Other */
.codehilite .sr { color: #E6DB74 } /* Literal.String.Regex */
.codehilite .s1 { color: #E6DB74 } /* Literal.String.Single */
.codehilite .ss { color: #E6DB74 } /* Literal.String.Symbol */
.codehilite .bp { color: #F8F8F2 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #A6E22E } /* Name.Function.Magic */
.codehilite .vc { color: #F8F8F2 } /* Name.Variable.Class */
.codehilite .vg { color: #F8F8F2 } /* Name.Variable.Global */
.codehilite .vi { color: #F8F8F2 } /* Name.Variable.Instance */
.codehilite .vm { color: #F8F8F2 } /* Name.Variable.Magic */
.codehilite .il { color: #AE81FF } /* Literal.Number.Integer.Long */

    .codehilite {
      background-color: var(--color-neutral);
      border-radius: 0.75rem;
      padding: 1.25rem;
      color: var(--color-neutral-content);
      font-family: "IBM Plex Mono", monospace;
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.45);
      overflow: hidden;
    }

    .codehilite pre {
      margin: 0;
      background: transparent;
      font-family: inherit;
      font-size: inherit;
      border: none;
      padding: 0;
      box-shadow: none;
      overflow-x: auto;
    }

    .codehilite__chrome {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.7rem;
      text-transform: uppercase;
      color: rgba(255, 255, 255, 0.7);
      gap: 1rem;
    }

    .codehilite__language {
      white-space: nowrap;
    }

    .codehilite__copy {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      border-radius: 999px;
      color: var(--color-neutral-content);
      font-family: inherit;
      font-size: 0.65rem;
      text-transform: uppercase;
      padding: 0.2rem 0.9rem;
      cursor: pointer;
      transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
    }

    .codehilite__copy:hover,
    .codehilite__copy:focus-visible {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.6);
    }

    .codehilite__copy[data-state="copied"] {
      background: var(--color-accent);
      color: var(--color-accent-content);
      border-color: transparent;
    }

    .codehilite__copy-icon {
      width: 0.85rem;
      height: 0.85rem;
      display: block;
    }

    .svg-inline--fa {
      display: inline;
    }
  </style>
</head>
<body class="doc-page">
  <a href="#main-content" class="skip-link sr-only-focusable">Skip to content</a>

  <header id="site-header" class="site-header">
    <div class="layout-shell layout-shell--docs site-header__inner">
      <a href="index.html" class="site-header__brand group">
        <span class="site-header__logo-mark">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <rect x="12" width="16.9706" height="16.9706" transform="rotate(45 12 0)" />
          </svg>
        </span>
        df12
      </a>
      <nav aria-label="Primary navigation" class="site-header__nav">
        <a href="index.html#systems" class="nav-link hit-target">Tools</a>
        <a href="index.html#worlds" class="nav-link hit-target" data-variant="accent">Creative</a>
        <a href="docs.html" class="nav-link hit-target" data-variant="neutral" aria-current="page">Docs</a>
      </nav>
      <div class="md:hidden">
        <details class="dropdown dropdown-end">
          <summary class="btn btn-ghost btn-sm site-header__menu-button">Menu</summary>
          <ul class="menu dropdown-content menu-sm z-[1] mt-2 w-44 rounded-box bg-base-100 p-2 shadow">
            <li><a href="index.html#systems" class="nav-link hit-target site-header__mobile-link">Tools</a></li>
            <li><a href="index.html#worlds" class="nav-link hit-target site-header__mobile-link" data-variant="accent">Creative</a></li>
            <li><a href="docs.html" class="nav-link hit-target site-header__mobile-link" data-variant="neutral" aria-current="page">Docs</a></li>
          </ul>
        </details>
      </div>
    </div>
  </header>

  <main id="main-content" class="site-main site-main--doc">
    <div class="layout-shell layout-shell--docs doc-grid">
      <aside class="doc-sidebar" aria-label="Documentation navigation">
        <div class="doc-sidebar__panel">
          <a href="docs.html" class="doc-sidebar__back">
            <iconify-icon icon="carbon:arrow-left" class="h-4 w-4" aria-hidden="true"></iconify-icon>
            Back to docs
          </a>
          <div>
            <p class="doc-sidebar__eyebrow">Falcon Pachinko</p>
            <p class="doc-sidebar__body">Falcon extension for structured WebSocket routing and event orchestration. Define msgspec payload schemas, spin up background workers, and broadcast updates to rooms—all without turning your ASGI app into spaghetti.
</p>
          </div>
          <div class="doc-sidebar__groups">
              <div class="doc-nav-group" aria-label="Introduction">
                <h3 class="doc-nav-group__title " >
                  <a href="docs-falcon-pachinko-introduction.html">Introduction</a>
                </h3>
              </div>
              <div class="doc-nav-group" aria-label="Literature Survey and Existing Solutions">
                <h3 class="doc-nav-group__title " >
                  <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html">Literature Survey and Existing Solutions</a>
                </h3>
                  <ul class="doc-nav__list" role="list">
                      <li>
                        <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html#literature-survey-and-existing-solutions-2-1-falcon-s-native-websocket-capabilities"
                           class="doc-nav__link "
>
                          <span>2.1. Falcon's Native WebSocket Capabilities</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html#literature-survey-and-existing-solutions-2-2-starlette"
                           class="doc-nav__link "
>
                          <span>2.2. Starlette</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html#literature-survey-and-existing-solutions-2-3-django-channels"
                           class="doc-nav__link "
>
                          <span>2.3. Django Channels</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html#literature-survey-and-existing-solutions-2-4-fastapi"
                           class="doc-nav__link "
>
                          <span>2.4. FastAPI</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html#literature-survey-and-existing-solutions-2-5-websockets-library"
                           class="doc-nav__link "
>
                          <span>2.5. `websockets` Library</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html#literature-survey-and-existing-solutions-2-6-gap-analysis-and-opportunity"
                           class="doc-nav__link "
>
                          <span>2.6. Gap Analysis and Opportunity</span>
                        </a>
                      </li>
                  </ul>
              </div>
              <div class="doc-nav-group" aria-label="Proposed Design for Falcon WebSocket Extension ("Falcon-Pachinko")">
                <h3 class="doc-nav-group__title " >
                  <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html">Proposed Design for Falcon WebSocket Extension ("Falcon-Pachinko")</a>
                </h3>
                  <ul class="doc-nav__list" role="list">
                      <li>
                        <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-1-core-principles"
                           class="doc-nav__link "
>
                          <span>3.1. Core Principles</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-2-key-components"
                           class="doc-nav__link "
>
                          <span>3.2. Key Components</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-3-application-integration"
                           class="doc-nav__link "
>
                          <span>3.3. Application Integration</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-4-routing-websocket-connections"
                           class="doc-nav__link "
>
                          <span>3.4. Routing WebSocket Connections</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-5-the-websocketresource-class"
                           class="doc-nav__link "
>
                          <span>3.5. The `WebSocketResource` Class</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-6-message-handling-and-dispatch"
                           class="doc-nav__link "
>
                          <span>3.6. Message Handling and Dispatch</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-7-websocketconnectionmanager"
                           class="doc-nav__link "
>
                          <span>3.7. `WebSocketConnectionManager`</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-8-background-worker-integration-via-asgi-lifespan"
                           class="doc-nav__link "
>
                          <span>3.8. Background Worker Integration via ASGI Lifespan</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-9-api-overview"
                           class="doc-nav__link "
>
                          <span>3.9. API Overview</span>
                        </a>
                      </li>
                  </ul>
              </div>
              <div class="doc-nav-group" aria-label="Illustrative Usecase: Real-time Chat Application">
                <h3 class="doc-nav-group__title is-active" aria-current="page">
                  <a href="docs-falcon-pachinko-illustrative-usecase-real-time-chat-application.html">Illustrative Usecase: Real-time Chat Application</a>
                </h3>
                  <ul class="doc-nav__list" role="list">
                      <li>
                        <a href="docs-falcon-pachinko-illustrative-usecase-real-time-chat-application.html#illustrative-usecase-real-time-chat-application-4-1-scenario-overview"
                           class="doc-nav__link "
>
                          <span>4.1. Scenario Overview</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-illustrative-usecase-real-time-chat-application.html#illustrative-usecase-real-time-chat-application-4-2-defining-the-chat-websocket-resource"
                           class="doc-nav__link "
>
                          <span>4.2. Defining the Chat WebSocket Resource</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-illustrative-usecase-real-time-chat-application.html#illustrative-usecase-real-time-chat-application-4-3-routing-and-application-setup"
                           class="doc-nav__link "
>
                          <span>4.3. Routing and Application Setup</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-illustrative-usecase-real-time-chat-application.html#illustrative-usecase-real-time-chat-application-4-4-client-side-interaction-conceptual"
                           class="doc-nav__link "
>
                          <span>4.4. Client-Side Interaction (Conceptual)</span>
                        </a>
                      </li>
                  </ul>
              </div>
              <div class="doc-nav-group" aria-label="Advanced Proposal: Composable and Schema-Driven WebSocket Routing">
                <h3 class="doc-nav-group__title " >
                  <a href="docs-falcon-pachinko-advanced-proposal-composable-and-schema-driven-websocket-routing.html">Advanced Proposal: Composable and Schema-Driven WebSocket Routing</a>
                </h3>
                  <ul class="doc-nav__list" role="list">
                      <li>
                        <a href="docs-falcon-pachinko-advanced-proposal-composable-and-schema-driven-websocket-routing.html#advanced-proposal-composable-and-schema-driven-websocket-routing-5-1-the-websocketrouter-as-a-composable-falcon-resource"
                           class="doc-nav__link "
>
                          <span>5.1. The `WebSocketRouter` as a Composable Falcon Resource</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-advanced-proposal-composable-and-schema-driven-websocket-routing.html#advanced-proposal-composable-and-schema-driven-websocket-routing-5-2-composable-architecture-nested-resources"
                           class="doc-nav__link "
>
                          <span>5.2. Composable Architecture: Nested Resources</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-advanced-proposal-composable-and-schema-driven-websocket-routing.html#advanced-proposal-composable-and-schema-driven-websocket-routing-5-3-high-performance-schema-driven-dispatch-with-msgspec"
                           class="doc-nav__link "
>
                          <span>5.3. High-Performance Schema-Driven Dispatch with `msgspec`</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-advanced-proposal-composable-and-schema-driven-websocket-routing.html#advanced-proposal-composable-and-schema-driven-websocket-routing-5-4-a-multi-tiered-middleware-and-hook-system"
                           class="doc-nav__link "
>
                          <span>5.4. A Multi-Tiered Middleware and Hook System</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-advanced-proposal-composable-and-schema-driven-websocket-routing.html#advanced-proposal-composable-and-schema-driven-websocket-routing-5-5-architectural-implications"
                           class="doc-nav__link "
>
                          <span>5.5. Architectural Implications</span>
                        </a>
                      </li>
                  </ul>
              </div>
              <div class="doc-nav-group" aria-label="Future Considerations and Potential Enhancements">
                <h3 class="doc-nav-group__title " >
                  <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html">Future Considerations and Potential Enhancements</a>
                </h3>
                  <ul class="doc-nav__list" role="list">
                      <li>
                        <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html#future-considerations-and-potential-enhancements-6-1-advanced-subprotocol-handling"
                           class="doc-nav__link "
>
                          <span>6.1. Advanced Subprotocol Handling</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html#future-considerations-and-potential-enhancements-6-2-compression-extensions"
                           class="doc-nav__link "
>
                          <span>6.2. Compression Extensions</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html#future-considerations-and-potential-enhancements-6-3-enhanced-connection-grouping-and-targeting"
                           class="doc-nav__link "
>
                          <span>6.3. Enhanced Connection Grouping and Targeting</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html#future-considerations-and-potential-enhancements-6-4-scalability-for-distributed-systems"
                           class="doc-nav__link "
>
                          <span>6.4. Scalability for Distributed Systems</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html#future-considerations-and-potential-enhancements-6-5-testing-utilities"
                           class="doc-nav__link "
>
                          <span>6.5. Testing Utilities</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html#future-considerations-and-potential-enhancements-6-6-automatic-asyncapi-documentation-generation-ambitious"
                           class="doc-nav__link "
>
                          <span>6.6. Automatic AsyncAPI Documentation Generation (Ambitious)</span>
                        </a>
                      </li>
                  </ul>
              </div>
              <div class="doc-nav-group" aria-label="Conclusion">
                <h3 class="doc-nav-group__title " >
                  <a href="docs-falcon-pachinko-conclusion.html">Conclusion</a>
                </h3>
                  <ul class="doc-nav__list" role="list">
                      <li>
                        <a href="docs-falcon-pachinko-conclusion.html#conclusion-7-1-summary-of-the-proposed-design"
                           class="doc-nav__link "
>
                          <span>7.1. Summary of the Proposed Design</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-conclusion.html#conclusion-7-2-benefits-and-advantages"
                           class="doc-nav__link "
>
                          <span>7.2. Benefits and Advantages</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-conclusion.html#conclusion-7-3-meeting-user-requirements"
                           class="doc-nav__link "
>
                          <span>7.3. Meeting User Requirements</span>
                        </a>
                      </li>
                      <li>
                        <a href="docs-falcon-pachinko-conclusion.html#conclusion-7-4-final-thoughts"
                           class="doc-nav__link "
>
                          <span>7.4. Final Thoughts</span>
                        </a>
                      </li>
                  </ul>
              </div>
          </div>
          <div>
            <p class="doc-sidebar__section-label">Source</p>
            <a class="inline-flex items-center gap-2 font-semibold text-primary" href="https://raw.githubusercontent.com/leynos/falcon-pachinko/refs/heads/main/docs/falcon-websocket-extension-design.md" target="_blank" rel="noopener">
              View markdown
              <iconify-icon icon="carbon:arrow-up-right" aria-hidden="true"></iconify-icon>
            </a>
            <p class="mt-1 text-xs text-base-content/60">Source material</p>
          </div>
        </div>
      </aside>

      <section class="space-y-6" id="illustrative-usecase-real-time-chat-application">
        <nav class="doc-mobile-nav" aria-labelledby="mobile-sections-label">
          <p id="mobile-sections-label" class="doc-sidebar__section-label">Contents</p>
          <ul class="doc-nav__list doc-nav__list--mobile" role="list">
              <li class="doc-nav-group">
                <h3 class="doc-nav-group__title">Introduction</h3>
                <ul class="doc-nav__list doc-nav__list--mobile" role="list">
                    <li>
                      <a href="docs-falcon-pachinko-introduction.html" class="doc-nav__link">Introduction</a>
                    </li>
                </ul>
              </li>
              <li class="doc-nav-group">
                <h3 class="doc-nav-group__title">Literature Survey and Existing Solutions</h3>
                <ul class="doc-nav__list doc-nav__list--mobile" role="list">
                    <li>
                      <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html" class="doc-nav__link">Literature Survey and Existing Solutions</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html#literature-survey-and-existing-solutions-2-1-falcon-s-native-websocket-capabilities" class="doc-nav__link">2.1. Falcon's Native WebSocket Capabilities</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html#literature-survey-and-existing-solutions-2-2-starlette" class="doc-nav__link">2.2. Starlette</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html#literature-survey-and-existing-solutions-2-3-django-channels" class="doc-nav__link">2.3. Django Channels</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html#literature-survey-and-existing-solutions-2-4-fastapi" class="doc-nav__link">2.4. FastAPI</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html#literature-survey-and-existing-solutions-2-5-websockets-library" class="doc-nav__link">2.5. `websockets` Library</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-literature-survey-and-existing-solutions.html#literature-survey-and-existing-solutions-2-6-gap-analysis-and-opportunity" class="doc-nav__link">2.6. Gap Analysis and Opportunity</a>
                    </li>
                </ul>
              </li>
              <li class="doc-nav-group">
                <h3 class="doc-nav-group__title">Proposed Design for Falcon WebSocket Extension ("Falcon-Pachinko")</h3>
                <ul class="doc-nav__list doc-nav__list--mobile" role="list">
                    <li>
                      <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html" class="doc-nav__link">Proposed Design for Falcon WebSocket Extension ("Falcon-Pachinko")</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-1-core-principles" class="doc-nav__link">3.1. Core Principles</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-2-key-components" class="doc-nav__link">3.2. Key Components</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-3-application-integration" class="doc-nav__link">3.3. Application Integration</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-4-routing-websocket-connections" class="doc-nav__link">3.4. Routing WebSocket Connections</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-5-the-websocketresource-class" class="doc-nav__link">3.5. The `WebSocketResource` Class</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-6-message-handling-and-dispatch" class="doc-nav__link">3.6. Message Handling and Dispatch</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-7-websocketconnectionmanager" class="doc-nav__link">3.7. `WebSocketConnectionManager`</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-8-background-worker-integration-via-asgi-lifespan" class="doc-nav__link">3.8. Background Worker Integration via ASGI Lifespan</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-proposed-design-for-falcon-websocket-extension-falcon-pachinko.html#proposed-design-for-falcon-websocket-extension-falcon-pachinko-3-9-api-overview" class="doc-nav__link">3.9. API Overview</a>
                    </li>
                </ul>
              </li>
              <li class="doc-nav-group">
                <h3 class="doc-nav-group__title">Illustrative Usecase: Real-time Chat Application</h3>
                <ul class="doc-nav__list doc-nav__list--mobile" role="list">
                    <li>
                      <a href="docs-falcon-pachinko-illustrative-usecase-real-time-chat-application.html" class="doc-nav__link">Illustrative Usecase: Real-time Chat Application</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-illustrative-usecase-real-time-chat-application.html#illustrative-usecase-real-time-chat-application-4-1-scenario-overview" class="doc-nav__link">4.1. Scenario Overview</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-illustrative-usecase-real-time-chat-application.html#illustrative-usecase-real-time-chat-application-4-2-defining-the-chat-websocket-resource" class="doc-nav__link">4.2. Defining the Chat WebSocket Resource</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-illustrative-usecase-real-time-chat-application.html#illustrative-usecase-real-time-chat-application-4-3-routing-and-application-setup" class="doc-nav__link">4.3. Routing and Application Setup</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-illustrative-usecase-real-time-chat-application.html#illustrative-usecase-real-time-chat-application-4-4-client-side-interaction-conceptual" class="doc-nav__link">4.4. Client-Side Interaction (Conceptual)</a>
                    </li>
                </ul>
              </li>
              <li class="doc-nav-group">
                <h3 class="doc-nav-group__title">Advanced Proposal: Composable and Schema-Driven WebSocket Routing</h3>
                <ul class="doc-nav__list doc-nav__list--mobile" role="list">
                    <li>
                      <a href="docs-falcon-pachinko-advanced-proposal-composable-and-schema-driven-websocket-routing.html" class="doc-nav__link">Advanced Proposal: Composable and Schema-Driven WebSocket Routing</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-advanced-proposal-composable-and-schema-driven-websocket-routing.html#advanced-proposal-composable-and-schema-driven-websocket-routing-5-1-the-websocketrouter-as-a-composable-falcon-resource" class="doc-nav__link">5.1. The `WebSocketRouter` as a Composable Falcon Resource</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-advanced-proposal-composable-and-schema-driven-websocket-routing.html#advanced-proposal-composable-and-schema-driven-websocket-routing-5-2-composable-architecture-nested-resources" class="doc-nav__link">5.2. Composable Architecture: Nested Resources</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-advanced-proposal-composable-and-schema-driven-websocket-routing.html#advanced-proposal-composable-and-schema-driven-websocket-routing-5-3-high-performance-schema-driven-dispatch-with-msgspec" class="doc-nav__link">5.3. High-Performance Schema-Driven Dispatch with `msgspec`</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-advanced-proposal-composable-and-schema-driven-websocket-routing.html#advanced-proposal-composable-and-schema-driven-websocket-routing-5-4-a-multi-tiered-middleware-and-hook-system" class="doc-nav__link">5.4. A Multi-Tiered Middleware and Hook System</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-advanced-proposal-composable-and-schema-driven-websocket-routing.html#advanced-proposal-composable-and-schema-driven-websocket-routing-5-5-architectural-implications" class="doc-nav__link">5.5. Architectural Implications</a>
                    </li>
                </ul>
              </li>
              <li class="doc-nav-group">
                <h3 class="doc-nav-group__title">Future Considerations and Potential Enhancements</h3>
                <ul class="doc-nav__list doc-nav__list--mobile" role="list">
                    <li>
                      <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html" class="doc-nav__link">Future Considerations and Potential Enhancements</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html#future-considerations-and-potential-enhancements-6-1-advanced-subprotocol-handling" class="doc-nav__link">6.1. Advanced Subprotocol Handling</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html#future-considerations-and-potential-enhancements-6-2-compression-extensions" class="doc-nav__link">6.2. Compression Extensions</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html#future-considerations-and-potential-enhancements-6-3-enhanced-connection-grouping-and-targeting" class="doc-nav__link">6.3. Enhanced Connection Grouping and Targeting</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html#future-considerations-and-potential-enhancements-6-4-scalability-for-distributed-systems" class="doc-nav__link">6.4. Scalability for Distributed Systems</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html#future-considerations-and-potential-enhancements-6-5-testing-utilities" class="doc-nav__link">6.5. Testing Utilities</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-future-considerations-and-potential-enhancements.html#future-considerations-and-potential-enhancements-6-6-automatic-asyncapi-documentation-generation-ambitious" class="doc-nav__link">6.6. Automatic AsyncAPI Documentation Generation (Ambitious)</a>
                    </li>
                </ul>
              </li>
              <li class="doc-nav-group">
                <h3 class="doc-nav-group__title">Conclusion</h3>
                <ul class="doc-nav__list doc-nav__list--mobile" role="list">
                    <li>
                      <a href="docs-falcon-pachinko-conclusion.html" class="doc-nav__link">Conclusion</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-conclusion.html#conclusion-7-1-summary-of-the-proposed-design" class="doc-nav__link">7.1. Summary of the Proposed Design</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-conclusion.html#conclusion-7-2-benefits-and-advantages" class="doc-nav__link">7.2. Benefits and Advantages</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-conclusion.html#conclusion-7-3-meeting-user-requirements" class="doc-nav__link">7.3. Meeting User Requirements</a>
                    </li>
                    <li>
                      <a href="docs-falcon-pachinko-conclusion.html#conclusion-7-4-final-thoughts" class="doc-nav__link">7.4. Final Thoughts</a>
                    </li>
                </ul>
              </li>
          </ul>
        </nav>

        <header class="doc-hero" id="doc-title">
          <h1 class="doc-hero__title">Illustrative Usecase: Real-time Chat Application</h1>
          <div class="doc-meta-list">
            <span class="doc-meta-list__item">Updated Nov 13, 2025</span>
          </div>
        </header>

        <article class="doc-article">
              <section class="doc-section">
                <div class="doc-prose"><p>To demonstrate the practical application and ergonomics of the proposed
Falcon-Pachinko extension, this section outlines its use in building a
real-time chat application.</p></div>
              </section>
                <section id="illustrative-usecase-real-time-chat-application-4-1-scenario-overview" class="doc-section">
                  <div class="doc-section__heading">
                    <h2>4.1. Scenario Overview</h2>
                  </div>
                  <div class="doc-prose"><p>The chat application will support multiple chat rooms. Users can connect to a
specific room via a WebSocket URL (e.g., <code>/ws/chat/{room_name}</code>). Once
connected, they can send messages, and these messages will be broadcast to all
other users in the same room. The application will also support presence
indications (users joining/leaving) and typing indicators.</p>
<p>An AsyncAPI document (used as a design artifact) would define the message
structures. For example:</p>
<ul>
<li>
<p>Client to Server:</p>
</li>
<li>
<p><code>{"type": "clientSendMessage", "payload": {"text": "Hello everyone!"}}</code></p>
</li>
<li>
<p><code>{"type": "clientStartTyping"}</code></p>
</li>
<li>
<p><code>{"type": "clientStopTyping"}</code></p>
</li>
<li>
<p>Server to Client:</p>
</li>
<li>
<p><code>{"type": "serverNewMessage", "payload": {"user": "Alice", "text": "Hello
    everyone!"}}</code></p>
</li>
<li>
<p><code>{"type": "serverUserJoined", "payload": {"user": "Bob"}}</code></p>
</li>
<li>
<p><code>{"type": "serverUserLeft", "payload": {"user": "Alice"}}</code></p>
</li>
<li>
<p><code>{"type": "serverUserTyping", "payload": {"user": "Charlie", "isTyping":
    true}}</code></p>
</li>
</ul></div>
                </section>
                <section id="illustrative-usecase-real-time-chat-application-4-2-defining-the-chat-websocket-resource" class="doc-section">
                  <div class="doc-section__heading">
                    <h2>4.2. Defining the Chat WebSocket Resource</h2>
                  </div>
                  <div class="doc-prose"><p>A <code>ChatRoomResource</code> class would be defined, inheriting from
<code>falcon_pachinko.WebSocketResource</code>:</p>
<div class="codehilite" data-language="python"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">falcon.asgi</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">falcon_pachinko</span><span class="w"> </span><span class="kn">import</span> <span class="n">WebSocketLike</span><span class="p">,</span> <span class="n">WebSocketResource</span><span class="p">,</span> <span class="n">handles_message</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ChatRoomResource</span><span class="p">(</span><span class="n">WebSocketResource</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="n">falcon</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="n">WebSocketLike</span><span class="p">,</span> <span class="n">room_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># Assume authentication middleware has set req.context.user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span> <span class="c1"># Reject connection</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">room_name</span> <span class="o">=</span> <span class="n">room_name</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_room</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">room_name</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">send_media</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;serverSystemMessage&quot;</span><span class="p">,</span>
            <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Welcome </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> to room &#39;</span><span class="si">{</span><span class="n">room_name</span><span class="si">}</span><span class="s2">&#39;!&quot;</span><span class="p">}</span>
        <span class="p">})</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_to_room</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">room_name</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;serverUserJoined&quot;</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">}},</span>
            <span class="n">exclude_self</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@handles_message</span><span class="p">(</span><span class="s2">&quot;clientSendMessage&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="n">WebSocketLike</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">message_text</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="c1"># Add validation/sanitization as needed</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_to_room</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">room_name</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;serverNewMessage&quot;</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">message_text</span><span class="p">}}</span>
        <span class="p">)</span>

    <span class="nd">@handles_message</span><span class="p">(</span><span class="s2">&quot;clientStartTyping&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_start_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="n">WebSocketLike</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_to_room</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">room_name</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;serverUserTyping&quot;</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;isTyping&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
            <span class="n">exclude_self</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="nd">@handles_message</span><span class="p">(</span><span class="s2">&quot;clientStopTyping&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_stop_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="n">WebSocketLike</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_to_room</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">room_name</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;serverUserTyping&quot;</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;isTyping&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}},</span>
            <span class="n">exclude_self</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="n">WebSocketLike</span><span class="p">,</span> <span class="n">close_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;room_name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">):</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">broadcast_to_room</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">room_name</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;serverUserLeft&quot;</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">}},</span>
                <span class="n">exclude_self</span><span class="o">=</span><span class="kc">True</span> 
            <span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">leave_room</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">room_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> disconnected from room&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;room_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> with code </span><span class="si">{</span><span class="n">close_code</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_unhandled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="n">WebSocketLike</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]):</span>
        <span class="c1"># Fallback for messages not matching handled types or non-JSON</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received unhandled message from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">room_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">send_media</span><span class="p">({</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;serverError&quot;</span><span class="p">,</span>
            <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unrecognized message format or type.&quot;</span><span class="p">}</span>
        <span class="p">})</span>
</code></pre></div>

<p>This example demonstrates how the <code>WebSocketResource</code> streamlines the
development of a feature-rich chat application. The abstractions for room
management and typed message handling significantly reduce boilerplate code.</p></div>
                </section>
                <section id="illustrative-usecase-real-time-chat-application-4-3-routing-and-application-setup" class="doc-section">
                  <div class="doc-section__heading">
                    <h2>4.3. Routing and Application Setup</h2>
                  </div>
                  <div class="doc-prose"><p>In the main application file:</p>
<div class="codehilite" data-language="python"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">falcon.asgi</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">falcon_pachinko</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">falcon_pachinko.workers</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkerController</span>

<span class="c1"># Assuming ChatRoomResource is defined as above</span>
<span class="c1"># Assuming an authentication middleware `AuthMiddleware` that sets `req.context.user`</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">asgi</span><span class="o">.</span><span class="n">App</span><span class="p">(</span><span class="n">middleware</span><span class="o">=</span><span class="p">[</span><span class="n">AuthMiddleware</span><span class="p">()])</span>
<span class="n">falcon_pachinko</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">conn_mgr</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">ws_connection_manager</span>

<span class="c1"># Add the WebSocket route</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_websocket_route</span><span class="p">(</span><span class="s1">&#39;/ws/chat/</span><span class="si">{room_name}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ChatRoomResource</span><span class="p">)</span>

<span class="c1"># Define a background worker</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">system_announcement_worker</span><span class="p">(</span><span class="n">conn_mgr</span><span class="p">:</span> <span class="n">falcon_pachinko</span><span class="o">.</span><span class="n">WebSocketConnectionManager</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3600</span><span class="p">)</span> <span class="c1"># Every hour</span>
        <span class="n">announcement_text</span> <span class="o">=</span> <span class="s2">&quot;System maintenance is scheduled for 2 AM UTC.&quot;</span>
        <span class="n">chat_room_ids</span> <span class="o">=</span> <span class="k">await</span> <span class="n">conn_mgr</span><span class="o">.</span><span class="n">get_rooms_by_prefix</span><span class="p">(</span><span class="s2">&quot;chat_&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">room_id</span> <span class="ow">in</span> <span class="n">chat_room_ids</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">conn_mgr</span><span class="o">.</span><span class="n">broadcast_to_room</span><span class="p">(</span>
                <span class="n">room_id</span><span class="p">,</span>
                <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;serverSystemAnnouncement&quot;</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">announcement_text</span><span class="p">}}</span>
            <span class="p">)</span>

<span class="c1"># Manage the worker with the ASGI lifespan</span>
<span class="n">controller</span> <span class="o">=</span> <span class="n">WorkerController</span><span class="p">()</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">lifespan</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">lifespan</span><span class="p">(</span><span class="n">app_instance</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">controller</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">system_announcement_worker</span><span class="p">,</span> <span class="n">conn_mgr</span><span class="o">=</span><span class="n">conn_mgr</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="k">await</span> <span class="n">controller</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div></div>
                </section>
                <section id="illustrative-usecase-real-time-chat-application-4-4-client-side-interaction-conceptual" class="doc-section">
                  <div class="doc-section__heading">
                    <h2>4.4. Client-Side Interaction (Conceptual)</h2>
                  </div>
                  <div class="doc-prose"><p>A JavaScript client would interact as follows:</p>
<ol>
<li>
<p><strong>Connect</strong>:
   <code>const socket = new WebSocket("ws://localhost:8000/ws/chat/general");</code></p>
</li>
<li>
<p><strong>Send Messages</strong>:</p>
</li>
</ol>
<div class="codehilite" data-language="javascript"><pre><span></span><code><span class="w">   </span><span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;clientSendMessage&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">payload</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Hi there!&quot;</span><span class="p">}}));</span>
<span class="w">   </span><span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;clientStartTyping&quot;</span><span class="p">}));</span>
</code></pre></div>

<ol start="3">
<li><strong>Receive Messages</strong>:</li>
</ol>
<div class="codehilite" data-language="javascript"><pre><span></span><code><span class="w">   </span><span class="nx">socket</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="kd">const</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">       </span><span class="k">switch</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">           </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;serverNewMessage&quot;</span><span class="o">:</span>
<span class="w">               </span><span class="c1">// Display message.payload.user and message.payload.text</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">           </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;serverUserJoined&quot;</span><span class="o">:</span>
<span class="w">               </span><span class="c1">// Update user list with message.payload.user</span>
<span class="w">               </span><span class="k">break</span><span class="p">;</span>
<span class="w">           </span><span class="c1">// Handle other message types...</span>
<span class="w">       </span><span class="p">}</span>
<span class="w">   </span><span class="p">};</span>
</code></pre></div>

<p>This illustrative use case shows how Falcon-Pachinko can provide a
comprehensive and developer-friendly solution for building real-time
applications on Falcon.</p></div>
                </section>
        </article>
      </section>
    </div>
  </main>

  <footer id="footer" class="site-footer">
    <div class="site-footer__grid site-footer__grid--docs">
      <div>
        <p class="site-footer__brand">df12 Productions</p>
        <p class="site-footer__text">Serious systems, playful worlds. We ship tools that cut build times and stories that map the human edge of complex networks.</p>
      </div>
      <div>
        <h2>OSS &amp; Licences</h2>
        <ul class="site-footer__list">
          <li><a class="footer-link" href="https://github.com/leynos/limela/blob/main/LICENSE" target="_blank" rel="noopener noreferrer">Limela — licence</a></li>
          <li><a class="footer-link" href="https://github.com/leynos/netsuke/blob/main/LICENSE" target="_blank" rel="noopener noreferrer">Netsuke — licence</a></li>
          <li><a class="footer-link" href="https://github.com/leynos/mxd/blob/main/LICENSE" target="_blank" rel="noopener noreferrer">mxd — licence</a></li>
          <li><a class="footer-link" href="https://github.com/leynos/episodic/blob/main/LICENSE" target="_blank" rel="noopener noreferrer">Episodic — licence</a></li>
        </ul>
      </div>
      <div>
        <h3>Stay in touch</h3>
        <ul class="site-footer__list">
          <li><a class="footer-link" data-variant="accent" href="mailto:hello@df12.studio">hello@df12.studio</a></li>
          <li>
            <a class="footer-link" data-variant="accent" href="https://github.com/leynos" target="_blank" rel="noopener noreferrer">
              <iconify-icon icon="carbon:logo-github" class="h-4 w-4" aria-hidden="true"></iconify-icon>
              GitHub
            </a>
          </li>
          <li>
            <a class="footer-link" data-variant="accent" href="https://bsky.app/profile/df12.studio" target="_blank" rel="noopener noreferrer">
              <iconify-icon icon="carbon:logo-bluesky" class="h-4 w-4" aria-hidden="true"></iconify-icon>
              Bluesky
            </a>
          </li>
        </ul>
        <p class="site-footer__closing">Built for curious builders and storytellers everywhere. ©&nbsp;2025&nbsp;df12&nbsp;Productions.</p>
      </div>
    </div>
  </footer>

  <script>
    (() => {
      const blocks = document.querySelectorAll('.codehilite');
      if (!blocks.length) {
        return;
      }

      const formatLanguage = (raw) => {
        const value = (raw || '').trim();
        if (!value || value.toLowerCase() === 'text') {
          return 'Plain Text';
        }
        return value
          .replace(/[._-]+/g, ' ')
          .replace(/\b\w/g, (char) => char.toUpperCase());
      };

      const writeClipboard = async (text) => {
        if (!text) {
          return false;
        }
        try {
          if (navigator.clipboard?.writeText) {
            await navigator.clipboard.writeText(text);
            return true;
          }
        } catch (error) {
          /* fall back */
        }

        try {
          const textarea = document.createElement('textarea');
          textarea.value = text;
          textarea.setAttribute('readonly', 'readonly');
          textarea.style.position = 'absolute';
          textarea.style.left = '-9999px';
          document.body.appendChild(textarea);
          textarea.select();
          const success = document.execCommand('copy');
          document.body.removeChild(textarea);
          return success;
        } catch (error) {
          return false;
        }
      };

      blocks.forEach((block) => {
        if (block.dataset.enhanced === 'true') {
          return;
        }
        const pre = block.querySelector('pre');
        const code = block.querySelector('code') || pre;
        if (!pre || !code) {
          return;
        }

        block.dataset.enhanced = 'true';

        const chrome = document.createElement('div');
        chrome.className = 'codehilite__chrome';

        const languageLabel = document.createElement('span');
        languageLabel.className = 'codehilite__language';
        const lang = block.dataset.language || '';
        const readableLang = formatLanguage(lang);
        languageLabel.textContent = readableLang;

        const copyButton = document.createElement('button');
        copyButton.type = 'button';
        copyButton.className = 'codehilite__copy';
        copyButton.setAttribute('aria-label', `Copy ${readableLang} code snippet`);
        copyButton.innerHTML = `
          <span class="codehilite__copy-icon" aria-hidden="true">
            <iconify-icon icon="carbon:copy" class="h-4 w-4"></iconify-icon>
          </span>
          <span class="codehilite__copy-text">Copy</span>
        `;

        chrome.appendChild(languageLabel);
        chrome.appendChild(copyButton);
        block.insertBefore(chrome, pre);

        const copyTextLabel = copyButton.querySelector('.codehilite__copy-text');
        let resetTimer;

        copyButton.addEventListener('click', async () => {
          const textContent = code.textContent || '';
          const didCopy = await writeClipboard(textContent.trimEnd());
          if (!didCopy) {
            let selectionApplied = false;
            if (window.getSelection && document.createRange) {
              const selection = window.getSelection();
              if (selection) {
                try {
                  const range = document.createRange();
                  range.selectNodeContents(code);
                  selection.removeAllRanges();
                  selection.addRange(range);
                  selectionApplied = true;
                  const focusTarget = block.querySelector('pre');
                  if (focusTarget) {
                    if (focusTarget.tabIndex < 0) {
                      focusTarget.tabIndex = -1;
                    }
                    focusTarget.focus({ preventScroll: true });
                  }
                } catch (err) {
                  selectionApplied = false;
                }
              }
            }
            if (copyTextLabel) {
              copyTextLabel.textContent = selectionApplied
                ? 'Press ⌘/Ctrl+C'
                : 'Select the code and press ⌘/Ctrl+C';
            }
            clearTimeout(resetTimer);
            resetTimer = setTimeout(() => {
              copyButton.removeAttribute('data-state');
              if (copyTextLabel) {
                copyTextLabel.textContent = 'Copy';
              }
            }, 2500);
            return;
          }
          copyButton.dataset.state = 'copied';
          if (copyTextLabel) {
            copyTextLabel.textContent = 'Copied';
          }
          clearTimeout(resetTimer);
          resetTimer = setTimeout(() => {
            copyButton.removeAttribute('data-state');
            if (copyTextLabel) {
              copyTextLabel.textContent = 'Copy';
            }
          }, 2500);
        });
      });
    })();
  </script>
<script
  src="https://code.iconify.design/iconify-icon/2.1.0/iconify-icon.min.js"
  defer
  integrity="sha384-GPb5RlngihS9H0z1D137JsvzmeZ7tCpWEF4t5YDoTZyMsPP8S7h7vFDh4XhheU83"
  crossorigin="anonymous"
></script>
</body>
</html>